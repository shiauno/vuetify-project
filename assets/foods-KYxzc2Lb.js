import{a1 as H,aD as J,v as f,aa as K,W as Z,S as h,X as _,M as t,U as s,a9 as ee,a4 as b,a5 as c,a7 as E,V as ae,a6 as le,aw as i,ax as te,Y as l,ay as oe,az as re,aA as se,aB as ue,aC as ne,Q as ie}from"./index-BH6KwveT.js";import{c as de,a as z,b as m,u as me,d,V as pe}from"./index.esm-rv78hXjT.js";import{b as N}from"./route-block-B_A1xBdJ.js";import{V as ve,a as I}from"./VRow-D5H5HDMH.js";import{V as ge}from"./VDivider-tugaj4Jb.js";import{V as ce}from"./VDataTable-CS2q4Bze.js";import{V as fe}from"./VToolbar-CR3-YrL2.js";import{V as be}from"./VContainer-CzwkQyz7.js";import{V as Ve}from"./VSelect-xhhar1r-.js";import"./VPagination-DZkTEHw1.js";import"./VList-CdVK96T5.js";import"./ssrBoot--qFJkOWV.js";const ye={__name:"foods",setup(xe){const{apiAuth:V}=K(),p=H(),v=J([]),q=f(""),L=[{title:"ID",key:"_id",sortable:!0},{title:"圖片",key:"image",sortable:!1},{title:"名稱",key:"name",sortable:!0},{title:"分類",key:"category",sortable:!0},{title:"熱量(kcal)",key:"calorie",sortable:!0},{title:"水分(g)",key:"moisture",sortable:!0},{title:"蛋白質(g)",key:"protein",sortable:!0},{title:"脂肪(g)",key:"fat",sortable:!0},{title:"碳水化合物(g)",key:"carbo",sortable:!0},{title:"鈉(mg)",key:"sodium",sortable:!0},{title:"膳食纖維(g)",key:"fibre",sortable:!0},{title:"膽固醇(mg)",key:"cholesterol",sortable:!0},{title:"新增時間",key:"createdAt",sortable:!0},{title:"更新時間",key:"updatedAt",sortable:!0},{title:"編輯食物",key:"edit",sortable:!1},{title:"刪除食物",key:"deleteFood",sortable:!1}],A=async()=>{var o,e;try{const{data:n}=await V.get("/food/all");v.push(...n.result)}catch(n){console.log(n),p({text:((e=(o=n==null?void 0:n.response)==null?void 0:o.data)==null?void 0:e.message)||"未知錯誤",snackbarProps:{color:"red"}})}};A();const u=f({open:!1,id:""}),$=o=>{o&&(u.value.id=o._id,y.value.value=o.name,D.value.value=o.category,x.value.value=o.calorie,k.value.value=o.moisture,w.value.value=o.protein,C.value.value=o.fat,U.value.value=o.carbo,M.value.value=o.sodium,F.value.value=o.fibre,S.value.value=o.cholesterol),u.value.open=!0},B=()=>{Q(),u.value.id="",u.value.open=!1,T.value.deleteFileRecord()},O=de({name:z().required("食物名稱必填"),calorie:m().typeError("輸入的值必為數字").required("食物熱量必填").min(0,"食物熱量不可為負數"),moisture:m().typeError("輸入的值必為數字").required("食物水分必填").min(0,"食物水分不可為負數"),protein:m().typeError("輸入的值必為數字").required("食物蛋白質必填").min(0,"食物蛋白質不可為負數"),fat:m().typeError("輸入的值必為數字").required("食物脂肪必填").min(0,"食物脂肪不可為負數"),carbo:m().typeError("輸入的值必為數字").required("食物碳水必填").min(0,"食物碳水不可為負數"),sodium:m().typeError("輸入的值必為數字").required("食物鈉必填").min(0,"食物鈉不可為負數"),fibre:m().typeError("輸入的值必為數字").required("食物纖維必填").min(0,"食物纖維不可為負數"),cholesterol:m().typeError("輸入的值必為數字").required("食物膽固醇必填").min(0,"食物膽固醇不可為負數"),category:z().required("食物分類必填").oneOf(["穀物類","糕餅點心類","加工調理","肉類","蔬菜類","魚貝類","蛋類","堅果種子類","豆類","油脂類","飲料類","水果類","乳品類","調味料及辛香料類","其他類"],"食物分類不符")}),{handleSubmit:j,isSubmitting:P,resetForm:Q}=me({validationSchema:O,initialValues:{name:"",category:"",calorie:0,moisture:0,protein:0,fat:0,carbo:0,sodium:0,fibre:0,cholesterol:0}}),y=d("name"),x=d("calorie"),k=d("moisture"),w=d("protein"),C=d("fat"),U=d("carbo"),M=d("sodium"),F=d("fibre"),S=d("cholesterol"),D=d("category"),W=[{text:"穀物類",value:"穀物類"},{text:"糕餅點心類",value:"糕餅點心類"},{text:"加工調理",value:"加工調理"},{text:"肉類",value:"肉類"},{text:"蔬菜類",value:"蔬菜類"},{text:"魚貝類",value:"魚貝類"},{text:"蛋類",value:"蛋類"},{text:"堅果種子類",value:"堅果種子類"},{text:"豆類",value:"豆類"},{text:"油脂類",value:"油脂類"},{text:"飲料類",value:"飲料類"},{text:"水果類",value:"水果類"},{text:"乳品類",value:"乳品類"},{text:"調味料及辛香料類",value:"調味料及辛香料類"},{text:"其他類",value:"其他類"}],T=f([null]),g=f([]),R=f([]),X=j(async o=>{var e,n,a;if(!((e=g.value[0])!=null&&e.error)){if(u.value.id.length===0&&g.value.length===0){p({text:"圖片必填",snackbarProps:{color:"red"}});return}try{const r=new FormData;if(r.append("name",o.name),r.append("category",o.category),r.append("calorie",o.calorie),r.append("moisture",o.moisture),r.append("protein",o.protein),r.append("fat",o.fat),r.append("carbo",o.carbo),r.append("sodium",o.sodium),r.append("fibre",o.fibre),r.append("cholesterol",o.cholesterol),g.value.length>0&&r.append("image",g.value[0].file),u.value.id.length>0)await V.patch("/food/"+u.value.id,r);else{const{data:G}=await V.post("/food",r);console.log(G)}v.splice(0,v.length),A(),p({text:u.value.length>0?"編輯成功":"新增成功",snackbarProps:{color:"success"}}),B()}catch(r){console.log(r),p({text:((a=(n=r==null?void 0:r.response)==null?void 0:n.data)==null?void 0:a.message)||"編輯失敗，請稍後再試",snackbarProps:{color:"red"}})}}}),Y=async o=>{try{await V.delete(`/food/${o}`),p({text:"食物刪除成功",snackbarProps:{color:"success"}}),v.splice(0,v.length),A()}catch(e){console.log(e),p({text:"食物刪除失敗",snackbarProps:{color:"red"}})}};return(o,e)=>{const n=Z("vue-file-agent");return _(),h(ie,null,[t(be,null,{default:s(()=>[t(ve,null,{default:s(()=>[t(I,{cols:"12"},{default:s(()=>e[15]||(e[15]=[ee("h1",{class:"text-center"},"食物管理",-1)])),_:1}),t(ge),t(I,{cols:"12"},{default:s(()=>[t(ce,{items:v,headers:L,search:q.value,style:{"background-color":"#495f41"}},{top:s(()=>[t(fe,{style:{"background-color":"#495f41"}},{default:s(()=>[t(b,{onClick:e[0]||(e[0]=a=>$(null))},{default:s(()=>e[16]||(e[16]=[c("新增商品")])),_:1}),t(le),t(i,{modelValue:q.value,"onUpdate:modelValue":e[1]||(e[1]=a=>q.value=a),"prepend-inner-icon":"mdi-magnify",variant:"underlined","max-width":"400"},null,8,["modelValue"])]),_:1})]),"item.image":s(({value:a})=>[t(ae,{src:a,height:"50"},null,8,["src"])]),"item.createdAt":s(({value:a})=>[c(E(new Date(a).toLocaleString()),1)]),"item.updatedAt":s(({value:a})=>[c(E(new Date(a).toLocaleString()),1)]),"item.edit":s(({item:a})=>[t(b,{icon:"mdi-pencil",variant:"text",onClick:r=>$(a)},null,8,["onClick"])]),"item.deleteFood":s(({item:a})=>[t(b,{icon:"mdi-delete",variant:"text",onClick:r=>Y(a._id)},null,8,["onClick"])]),_:2},1032,["items","search"])]),_:1})]),_:1})]),_:1}),t(ne,{modelValue:u.value.open,"onUpdate:modelValue":e[14]||(e[14]=a=>u.value.open=a),persistent:""},{default:s(()=>[t(pe,{disabled:l(P),onSubmit:te(l(X),["prevent"])},{default:s(()=>[t(oe,null,{default:s(()=>[t(re,null,{default:s(()=>[c(E(u.value.id?"編輯食物":"新增食物"),1)]),_:1}),t(se,null,{default:s(()=>[t(i,{modelValue:l(y).value.value,"onUpdate:modelValue":e[2]||(e[2]=a=>l(y).value.value=a),label:"食物名稱","error-messages":l(y).errorMessage.value},null,8,["modelValue","error-messages"]),t(Ve,{modelValue:l(D).value.value,"onUpdate:modelValue":e[3]||(e[3]=a=>l(D).value.value=a),"error-messages":l(D).errorMessage.value,items:W,label:"分類","item-title":"text","item-value":"value"},null,8,["modelValue","error-messages"]),t(i,{modelValue:l(x).value.value,"onUpdate:modelValue":e[4]||(e[4]=a=>l(x).value.value=a),label:"熱量","error-messages":l(x).errorMessage.value,type:"number",min:"0"},null,8,["modelValue","error-messages"]),t(i,{modelValue:l(k).value.value,"onUpdate:modelValue":e[5]||(e[5]=a=>l(k).value.value=a),label:"水分","error-messages":l(k).errorMessage.value,type:"number",min:"0"},null,8,["modelValue","error-messages"]),t(i,{modelValue:l(w).value.value,"onUpdate:modelValue":e[6]||(e[6]=a=>l(w).value.value=a),label:"蛋白質","error-messages":l(w).errorMessage.value,type:"number",min:"0"},null,8,["modelValue","error-messages"]),t(i,{modelValue:l(C).value.value,"onUpdate:modelValue":e[7]||(e[7]=a=>l(C).value.value=a),label:"脂肪","error-messages":l(C).errorMessage.value,type:"number",min:"0"},null,8,["modelValue","error-messages"]),t(i,{modelValue:l(U).value.value,"onUpdate:modelValue":e[8]||(e[8]=a=>l(U).value.value=a),label:"碳水化合物","error-messages":l(U).errorMessage.value,type:"number",min:"0"},null,8,["modelValue","error-messages"]),t(i,{modelValue:l(M).value.value,"onUpdate:modelValue":e[9]||(e[9]=a=>l(M).value.value=a),label:"鈉","error-messages":l(M).errorMessage.value,type:"number",min:"0"},null,8,["modelValue","error-messages"]),t(i,{modelValue:l(F).value.value,"onUpdate:modelValue":e[10]||(e[10]=a=>l(F).value.value=a),label:"膳食纖維","error-messages":l(F).errorMessage.value,type:"number",min:"0"},null,8,["modelValue","error-messages"]),t(i,{modelValue:l(S).value.value,"onUpdate:modelValue":e[11]||(e[11]=a=>l(S).value.value=a),label:"膽固醇","error-messages":l(S).errorMessage.value,type:"number",min:"0"},null,8,["modelValue","error-messages"]),t(n,{ref_key:"fileAgent",ref:T,modelValue:g.value,"onUpdate:modelValue":e[12]||(e[12]=a=>g.value=a),"raw-model-value":R.value,"onUpdate:rawModelValue":e[13]||(e[13]=a=>R.value=a),accept:"image/jpeg,image/png",deletable:"","max-size":"1MB","help-text":"點擊或拖曳檔案至此","error-text":{type:"檔案類型錯誤",size:"檔案大小超過限制"}},null,8,["modelValue","raw-model-value"])]),_:1}),t(ue,null,{default:s(()=>[t(b,{onClick:B},{default:s(()=>e[17]||(e[17]=[c("取消")])),_:1}),t(b,{type:"submit",loading:l(P)},{default:s(()=>e[18]||(e[18]=[c("確認")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])],64)}}};typeof N=="function"&&N(ye);export{ye as default};
