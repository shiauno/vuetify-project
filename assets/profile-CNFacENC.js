import{a1 as P,v as d,a9 as M,W as R,S as T,X as E,M as a,U as l,a8 as _,a7 as N,V as $,a4 as u,a6 as c,a3 as x,aB as j,Y as m,av as q,aw as I,ax as Q,au as b,ay as W,az as X,Q as Y}from"./index-DXWk5PDB.js";import{c as G,b as H,u as J,d as K}from"./index.esm-CfiWTu7A.js";import{b as h}from"./route-block-B_A1xBdJ.js";import{V as z,a as g}from"./VRow-B38zuabs.js";import{V as L}from"./VContainer-B635RQ40.js";import{V as O}from"./VForm-OA6ZQvjk.js";const Z={class:"d-md-flex text-center mx-auto",style:{"max-width":"1000px","margin-top":"50px"}},ee={__name:"profile",setup(ae){const{apiAuth:w}=M(),v=P(),n=d({account:"",email:"",avatar:"",weight:0}),y=async()=>{var i,e;try{const{data:o}=await w.get("/user/profile");console.log(o.result),n.value=o.result,r.value={...o.result}}catch(o){console.log(o),v({text:((e=(i=o==null?void 0:o.response)==null?void 0:i.data)==null?void 0:e.message)||"未知錯誤",snackbarProps:{color:"red"}})}};y();const r=d({account:"",email:"",avatar:"",weight:0}),f=d({open:!1}),B=()=>{f.value.open=!0},k=()=>{f.value.open=!1,F.value.deleteFileRecord()},U=G({weight:H().typeError("輸入的值必為數字").required("體重必填").min(0,"體重不可為負數")}),{handleSubmit:A,isSubmitting:C}=J({validationSchema:U,initialValues:{weight:0}}),V=K("weight"),F=d([null]),p=d([]),S=d([]),D=A(async i=>{var e,o,t;if(console.log("Submit triggered",i),!((e=p.value[0])!=null&&e.error))try{const s=new FormData;s.append("weight",i.weight),p.value.length>0&&s.append("image",p.value[0].file),await w.patch("/user/edit",s),console.log(r.value.weight),n.value.weight=i.weight,y(),v({text:"編輯成功",snackbarProps:{color:"success"}}),k()}catch(s){console.log(s),v({text:((t=(o=s==null?void 0:s.response)==null?void 0:o.data)==null?void 0:t.message)||"編輯失敗，請稍後再試",snackbarProps:{color:"red"}})}});return(i,e)=>{const o=R("vue-file-agent");return E(),T(Y,null,[a(L,{"max-md-width":"1600"},{default:l(()=>[e[7]||(e[7]=_("h1",{style:{"margin-bottom":"20px"}},"個人資料",-1)),_("div",Z,[a(z,null,{default:l(()=>[a(N,{size:"200",style:{border:"1px solid black","margin-top":"10px",display:"inline-block"},color:"#89BE99"},{default:l(()=>[a($,{src:n.value.avatar},null,8,["src"])]),_:1})]),_:1}),a(z,null,{default:l(()=>[a(g,{cols:"12",style:{"font-size":"20px"}},{default:l(()=>[u("帳號: "+c(n.value.account),1)]),_:1}),a(g,{cols:"12",style:{"font-size":"20px"}},{default:l(()=>[u("信箱: "+c(n.value.email),1)]),_:1}),a(g,{cols:"12",style:{"font-size":"20px"}},{default:l(()=>[u("體重: "+c(n.value.weight)+" 公斤",1)]),_:1}),a(g,{cols:"12",style:{"font-size":"20px"}},{default:l(()=>[u("基本所需的熱量: "+c(n.value.weight*30)+" kcal",1)]),_:1})]),_:1}),a(x,{icon:"mdi-pencil",color:"#495F41",onClick:e[0]||(e[0]=t=>B())})])]),_:1}),a(X,{modelValue:f.value.open,"onUpdate:modelValue":e[6]||(e[6]=t=>f.value.open=t),persistent:"","max-width":"600"},{default:l(()=>[a(O,{disabled:m(C),onSubmit:j(m(D),["prevent"])},{default:l(()=>[a(q,null,{default:l(()=>[a(I,null,{default:l(()=>e[8]||(e[8]=[u("編輯個人資料")])),_:1}),a(Q,null,{default:l(()=>[a(b,{modelValue:r.value.account,"onUpdate:modelValue":e[1]||(e[1]=t=>r.value.account=t),label:"帳號",disabled:""},null,8,["modelValue"]),a(b,{modelValue:r.value.email,"onUpdate:modelValue":e[2]||(e[2]=t=>r.value.email=t),label:"信箱",disabled:""},null,8,["modelValue"]),a(b,{modelValue:m(V).value.value,"onUpdate:modelValue":e[3]||(e[3]=t=>m(V).value.value=t),label:"體重",type:"number","error-messages":m(V).meta.errors},null,8,["modelValue","error-messages"]),a(o,{ref_key:"fileAgent",ref:F,modelValue:p.value,"onUpdate:modelValue":e[4]||(e[4]=t=>p.value=t),"raw-model-value":S.value,"onUpdate:rawModelValue":e[5]||(e[5]=t=>S.value=t),accept:"image/jpeg,image/png",deletable:"","max-size":"1MB","help-text":"點擊或拖曳檔案至此","error-text":{type:"檔案類型錯誤",size:"檔案大小超過限制"}},null,8,["modelValue","raw-model-value"])]),_:1}),a(W,null,{default:l(()=>[a(x,{onClick:k},{default:l(()=>e[9]||(e[9]=[u("取消")])),_:1}),a(x,{type:"submit",loading:m(C)},{default:l(()=>e[10]||(e[10]=[u("確認")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])],64)}}};typeof h=="function"&&h(ee);export{ee as default};
