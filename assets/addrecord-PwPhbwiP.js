import{a1 as L,v as n,c as S,w as O,aa as R,av as z,S as q,X as f,M as l,U as t,a9 as c,aw as v,Q as P,Z as G,_ as I,N as Q,ax as X,Y as u,ay as Y,az as Z,a5 as V,aA as j,aB as H,a4 as U,aC as J}from"./index-BH6KwveT.js";import{_ as K}from"./Foodcard-VvPSamQD.js";import{c as W,a as h,b as ee,u as le,d as _,V as ae}from"./index.esm-rv78hXjT.js";import{b as B}from"./route-block-B_A1xBdJ.js";import{V as oe,a as i}from"./VRow-D5H5HDMH.js";import{V as te}from"./VPagination-DZkTEHw1.js";import{V as se}from"./VContainer-CzwkQyz7.js";import{V as ue}from"./VSelect-xhhar1r-.js";import"./VList-CdVK96T5.js";import"./ssrBoot--qFJkOWV.js";import"./VDivider-tugaj4Jb.js";const g=12,ne={__name:"addrecord",setup(re){const{apiAuth:b}=R(),y=L(),r=n(1),N=S(()=>Math.ceil(m.value.length/g)),m=n([]),p=n(""),d=n(""),A=S(()=>m.value.filter(a=>a.name.toLowerCase().includes(p.value.toLowerCase())).slice((r.value-1)*g,r.value*g));(async()=>{try{const{data:a}=await b.get("/food");m.value.push(...a.result)}catch(a){console.log(a)}})();const s=n({open:!1,food:null}),E=a=>{console.log("Selected food id: ",a),s.value.food=a,s.value.open=!0,console.log("有開嗎"+s.value.open)},x=()=>{s.value.food=null,s.value.open=!1};O(()=>s.value.food,a=>{d.value=a?a.name:"",console.log("新選中的食物:",a),console.log("foodName:",d.value)});const T=[{text:"早餐",value:"早餐"},{text:"午餐",value:"午餐"},{text:"晚餐",value:"晚餐"}],M=W({quantity:ee().typeError("輸入的值必為數字").required("份量必填").min(0,"分量不可為負數"),time:h().required("紀錄時段必填").oneOf(["早餐","午餐","晚餐"],"時段分類不符")}),{handleSubmit:$,isSubmitting:C}=le({validationSchema:M,initialValues:{quantity:1,time:"早餐"}}),k=_("quantity"),w=_("time"),D=$(async a=>{console.log(a);try{const e=new FormData;e.append("food",s.value.food._id),e.append("quantity",a.quantity),e.append("time",a.time);for(let F of e.entries())console.log(F[0]+": "+F[1]);const{data:o}=await b.post("/record",e);console.log(o.result),x(),z.push("./record"),y({text:"飲食紀錄新增成功",snackbarProps:{color:"success"}})}catch(e){console.log(e),y({text:"飲食紀錄新增失敗",snackbarProps:{color:"red"}})}});return(a,e)=>(f(),q(P,null,[l(se,{"max-width":"1600"},{default:t(()=>[e[7]||(e[7]=c("h1",null,"新增飲食紀錄",-1)),e[8]||(e[8]=c("br",null,null,-1)),l(oe,null,{default:t(()=>[l(i,{cols:"12"},{default:t(()=>[l(v,{modelValue:p.value,"onUpdate:modelValue":e[0]||(e[0]=o=>p.value=o),"prepend-icon":"mdi-magnify"},null,8,["modelValue"])]),_:1}),l(i,{cols:"12"},{default:t(()=>e[6]||(e[6]=[c("div",{style:{color:"red"}},"以下為食物每100克的含量",-1)])),_:1}),(f(!0),q(P,null,G(A.value,o=>(f(),I(i,{key:o._id,cols:"12",md:"6",lg:"3"},{default:t(()=>[l(K,Q({ref_for:!0},o,{"is-link":!1,onClickFood:()=>E(o)}),null,16,["onClickFood"])]),_:2},1024))),128)),l(i,{cols:"12"},{default:t(()=>[l(te,{modelValue:r.value,"onUpdate:modelValue":e[1]||(e[1]=o=>r.value=o),length:N.value},null,8,["modelValue","length"])]),_:1})]),_:1})]),_:1}),l(J,{modelValue:s.value.open,"onUpdate:modelValue":e[5]||(e[5]=o=>s.value.open=o),persistent:"","max-width":"500"},{default:t(()=>[l(ae,{disabled:u(C),onSubmit:X(u(D),["prevent"])},{default:t(()=>[l(Y,null,{default:t(()=>[l(Z,null,{default:t(()=>e[9]||(e[9]=[V("新增飲食紀錄")])),_:1}),l(j,null,{default:t(()=>[l(v,{modelValue:d.value,"onUpdate:modelValue":e[2]||(e[2]=o=>d.value=o),label:"食物名稱",disabled:""},null,8,["modelValue"]),l(v,{modelValue:u(k).value.value,"onUpdate:modelValue":e[3]||(e[3]=o=>u(k).value.value=o),label:"份數",type:"number",min:"0"},null,8,["modelValue"]),l(ue,{modelValue:u(w).value.value,"onUpdate:modelValue":e[4]||(e[4]=o=>u(w).value.value=o),label:"時段",items:T,"item-title":"text","item-value":"value"},null,8,["modelValue"])]),_:1}),l(H,null,{default:t(()=>[l(U,{onClick:x},{default:t(()=>e[10]||(e[10]=[V("取消")])),_:1}),l(U,{type:"submit",loading:u(C)},{default:t(()=>e[11]||(e[11]=[V("確認")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])],64))}};typeof B=="function"&&B(ne);export{ne as default};
