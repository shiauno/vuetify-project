import{a1 as D,v as s,c as F,w as L,aa as O,S,X as f,M as l,U as t,a9 as c,av as v,Q as q,Z as R,_ as z,N as G,aw as I,Y as u,ax as Q,ay as X,a5 as V,az as Y,aA as Z,a4 as P,aB as j}from"./index-DHdcEP79.js";import{_ as H}from"./Foodcard-BolxNtMW.js";import{c as J,a as K,b as W,u as h,d as U,V as ee}from"./index.esm-CnOEIQZ1.js";import{b as _}from"./route-block-B_A1xBdJ.js";import{V as le,a as i}from"./VRow-BzRD84OG.js";import{V as ae}from"./VPagination-j5TmAuxf.js";import{V as oe}from"./VContainer-DY3vQIwL.js";import{V as te}from"./VSelect-DqWhtwvf.js";import"./VList-DRQVUY5v.js";import"./ssrBoot-z32wLcZx.js";import"./VDivider-B6iXQcSP.js";const g=12,ne={__name:"addrecord",setup(ue){const{apiAuth:b}=O(),y=D(),d=s(1),B=F(()=>Math.ceil(m.value.length/g)),m=s([]),p=s(""),r=s(""),N=F(()=>m.value.filter(a=>a.name.toLowerCase().includes(p.value.toLowerCase())).slice((d.value-1)*g,d.value*g));(async()=>{try{const{data:a}=await b.get("/food");m.value.push(...a.result)}catch(a){console.log(a)}})();const n=s({open:!1,food:null}),A=a=>{console.log("Selected food id: ",a),n.value.food=a,n.value.open=!0,console.log("有開嗎"+n.value.open)},x=()=>{n.value.food=null,n.value.open=!1};L(()=>n.value.food,a=>{r.value=a?a.name:"",console.log("確定真的有開嗎",n.value.open),console.log("新選中的食物:",a),console.log("foodName:",r.value)});const E=[{text:"早餐",value:"早餐"},{text:"午餐",value:"午餐"},{text:"晚餐",value:"晚餐"}],T=J({quantity:W().typeError("輸入的值必為數字").required("份量必填").min(0,"分量不可為負數"),time:K().required("紀錄時段必填").oneOf(["早餐","午餐","晚餐"],"時段分類不符")}),{handleSubmit:M,isSubmitting:k}=h({validationSchema:T,initialValues:{food:"",quantity:1,time:"早上"}}),C=U("quantity"),w=U("time"),$=M(async a=>{console.log(a);try{const e=new FormData;e.append("food",n.value.food._id),e.append("quantity",a.quantity),e.append("time",a.time);const{data:o}=await b.post("/record",e);console.log(o.result),x(),y({text:"飲食紀錄新增成功",snackbarProps:{color:"success"}})}catch(e){console.log(e),y({text:"飲食紀錄新增失敗",snackbarProps:{color:"red"}})}});return(a,e)=>(f(),S(q,null,[l(oe,{"max-width":"1600"},{default:t(()=>[e[7]||(e[7]=c("h1",null,"新增飲食紀錄",-1)),e[8]||(e[8]=c("br",null,null,-1)),l(le,null,{default:t(()=>[l(i,{cols:"12"},{default:t(()=>[l(v,{modelValue:p.value,"onUpdate:modelValue":e[0]||(e[0]=o=>p.value=o),"prepend-icon":"mdi-magnify"},null,8,["modelValue"])]),_:1}),l(i,{cols:"12"},{default:t(()=>e[6]||(e[6]=[c("div",{style:{color:"red"}},"以下為食物每100克的含量",-1)])),_:1}),(f(!0),S(q,null,R(N.value,o=>(f(),z(i,{key:o._id,cols:"12",md:"6",lg:"3"},{default:t(()=>[l(H,G({ref_for:!0},o,{"is-link":!1,onClickFood:()=>A(o)}),null,16,["onClickFood"])]),_:2},1024))),128)),l(i,{cols:"12"},{default:t(()=>[l(ae,{modelValue:d.value,"onUpdate:modelValue":e[1]||(e[1]=o=>d.value=o),length:B.value},null,8,["modelValue","length"])]),_:1})]),_:1})]),_:1}),l(j,{modelValue:n.value.open,"onUpdate:modelValue":e[5]||(e[5]=o=>n.value.open=o),persistent:"","max-width":"500"},{default:t(()=>[l(ee,{disabled:u(k),onSubmit:I(u($),["prevent"])},{default:t(()=>[l(Q,null,{default:t(()=>[l(X,null,{default:t(()=>e[9]||(e[9]=[V("新增飲食紀錄")])),_:1}),l(Y,null,{default:t(()=>[l(v,{modelValue:r.value,"onUpdate:modelValue":e[2]||(e[2]=o=>r.value=o),label:"食物名稱",disabled:""},null,8,["modelValue"]),l(v,{modelValue:u(C).value.value,"onUpdate:modelValue":e[3]||(e[3]=o=>u(C).value.value=o),label:"份數",type:"number",min:"0"},null,8,["modelValue"]),l(te,{modelValue:u(w).value.value,"onUpdate:modelValue":e[4]||(e[4]=o=>u(w).value.value=o),label:"時段",items:E,"item-title":"text","item-value":"value"},null,8,["modelValue"])]),_:1}),l(Z,null,{default:t(()=>[l(P,{onClick:x},{default:t(()=>e[10]||(e[10]=[V("取消")])),_:1}),l(P,{type:"submit",loading:u(k)},{default:t(()=>e[11]||(e[11]=[V("確認")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])],64))}};typeof _=="function"&&_(ne);export{ne as default};
