import{a1 as X,aA as Y,v as p,a9 as G,W as H,S as J,X as K,M as t,U as u,a8 as Z,a3 as C,a4 as v,a6 as D,V as h,a5 as _,au as n,aB as ee,Y as l,av as ae,aw as le,ax as te,ay as re,az as oe,Q as ue}from"./index-DCTA5BSV.js";import{c as se,a as z,b as d,u as ne,d as i}from"./index.esm-DFDxVlUm.js";import{b as N}from"./route-block-B_A1xBdJ.js";import{V as ie,a as P}from"./VRow-5eXdQqNh.js";import{V as de}from"./VDivider-Bz54YqAU.js";import{V as me}from"./VDataTable-BLJt86b4.js";import{V as ve}from"./VToolbar-BXT4KDu8.js";import{V as pe}from"./VContainer-DCYKGdi1.js";import{V as ge}from"./VForm-CtHOijN8.js";import{V as fe}from"./VSelect-CC06fm8F.js";import"./VPagination-DsYxo7dQ.js";import"./VList-I4hasx3r.js";import"./ssrBoot-CmcddJss.js";const Ve={__name:"foods",setup(be){const{apiAuth:S}=G(),q=X(),g=Y([]),A=p(""),I=[{title:"ID",key:"_id",sortable:!0},{title:"圖片",key:"image",sortable:!1},{title:"名稱",key:"name",sortable:!0},{title:"分類",key:"category",sortable:!0},{title:"熱量(kcal)",key:"calorie",sortable:!0},{title:"水分(g)",key:"moisture",sortable:!0},{title:"蛋白質(g)",key:"protein",sortable:!0},{title:"脂肪(g)",key:"fat",sortable:!0},{title:"碳水化合物(g)",key:"carbo",sortable:!0},{title:"鈉(mg)",key:"sodium",sortable:!0},{title:"膳食纖維(g)",key:"fibre",sortable:!0},{title:"膽固醇(mg)",key:"cholesterol",sortable:!0},{title:"新增時間",key:"createdAt",sortable:!0},{title:"更新時間",key:"updatedAt",sortable:!0},{title:"編輯食物",key:"edit",sortable:!1}],F=async()=>{var r,e;try{const{data:o}=await S.get("/food/all");g.push(...o.result)}catch(o){console.log(o),q({text:((e=(r=o==null?void 0:o.response)==null?void 0:r.data)==null?void 0:e.message)||"未知錯誤",snackbarProps:{color:"red"}})}};F();const s=p({open:!1,id:""}),E=r=>{r&&(s.value.id=r._id,f.value.value=r.name,M.value.value=r.category,V.value.value=r.calorie,b.value.value=r.moisture,c.value.value=r.protein,y.value.value=r.fat,x.value.value=r.carbo,k.value.value=r.sodium,w.value.value=r.fibre,U.value.value=r.cholesterol),s.value.open=!0},B=()=>{j(),s.value.id="",s.value.open=!1,$.value.deleteFileRecord()},L=se({name:z().required("食物名稱必填"),calorie:d().typeError("輸入的值必為數字").required("食物熱量必填").min(0,"食物熱量不可為負數"),moisture:d().typeError("輸入的值必為數字").required("食物水分必填").min(0,"食物水分不可為負數"),protein:d().typeError("輸入的值必為數字").required("食物蛋白質必填").min(0,"食物蛋白質不可為負數"),fat:d().typeError("輸入的值必為數字").required("食物脂肪必填").min(0,"食物脂肪不可為負數"),carbo:d().typeError("輸入的值必為數字").required("食物碳水必填").min(0,"食物碳水不可為負數"),sodium:d().typeError("輸入的值必為數字").required("食物鈉必填").min(0,"食物鈉不可為負數"),fibre:d().typeError("輸入的值必為數字").required("食物纖維必填").min(0,"食物纖維不可為負數"),cholesterol:d().typeError("輸入的值必為數字").required("食物膽固醇必填").min(0,"食物膽固醇不可為負數"),category:z().required("食物分類必填").oneOf(["穀物類","糕餅點心類","加工調理","肉類","蔬菜類","魚貝類","蛋類","堅果種子類","豆類","油脂類","飲料類","水果類","乳品類","調味料及辛香料類","其他類"],"食物分類不符")}),{handleSubmit:O,isSubmitting:T,resetForm:j}=ne({validationSchema:L,initialValues:{name:"",category:"",calorie:0,moisture:0,protein:0,fat:0,carbo:0,sodium:0,fibre:0,cholesterol:0}}),f=i("name"),V=i("calorie"),b=i("moisture"),c=i("protein"),y=i("fat"),x=i("carbo"),k=i("sodium"),w=i("fibre"),U=i("cholesterol"),M=i("category"),Q=[{text:"穀物類",value:"穀物類"},{text:"糕餅點心類",value:"糕餅點心類"},{text:"加工調理",value:"加工調理"},{text:"肉類",value:"肉類"},{text:"蔬菜類",value:"蔬菜類"},{text:"魚貝類",value:"魚貝類"},{text:"蛋類",value:"蛋類"},{text:"堅果種子類",value:"堅果種子類"},{text:"豆類",value:"豆類"},{text:"油脂類",value:"油脂類"},{text:"飲料類",value:"飲料類"},{text:"水果類",value:"水果類"},{text:"乳品類",value:"乳品類"},{text:"調味料及辛香料類",value:"調味料及辛香料類"},{text:"其他類",value:"其他類"}],$=p([null]),m=p([]),R=p([]),W=O(async r=>{var e;if(!((e=m.value[0])!=null&&e.error)){if(s.value.id.length===0&&m.value.length===0){q({text:"圖片必填",snackbarProps:{color:"red"}});return}try{const o=new FormData;if(o.append("name",r.name),o.append("category",r.category),o.append("calorie",r.calorie),o.append("moisture",r.moisture),o.append("protein",r.protein),o.append("fat",r.fat),o.append("carbo",r.carbo),o.append("sodium",r.sodium),o.append("fibre",r.fibre),o.append("cholesterol",r.cholesterol),m.value.length>0&&o.append("image",m.value[0].file),s.value.id.length>0)await S.patch("/food/"+s.value.id,o);else{const{data:a}=await S.post("/food",o);console.log(a)}g.splice(0,g.length),F(),q({text:s.value.length>0?"編輯成功":"新增成功",snackbarProps:{color:"success"}}),B()}catch(o){console.log(o)}}});return(r,e)=>{const o=H("vue-file-agent");return K(),J(ue,null,[t(pe,null,{default:u(()=>[t(ie,null,{default:u(()=>[t(P,{cols:"12"},{default:u(()=>e[15]||(e[15]=[Z("h1",{class:"text-center"},"食物管理",-1)])),_:1}),t(de),t(P,{cols:"12"},{default:u(()=>[t(me,{items:g,headers:I,search:A.value},{top:u(()=>[t(ve,null,{default:u(()=>[t(C,{onClick:e[0]||(e[0]=a=>E(null))},{default:u(()=>e[16]||(e[16]=[v("新增商品")])),_:1}),t(_),t(n,{modelValue:A.value,"onUpdate:modelValue":e[1]||(e[1]=a=>A.value=a),"prepend-inner-icon":"mdi-magnify",variant:"underlined","max-width":"400"},null,8,["modelValue"])]),_:1})]),"item.image":u(({value:a})=>[t(h,{src:a,height:"50"},null,8,["src"])]),"item.createdAt":u(({value:a})=>[v(D(new Date(a).toLocaleString()),1)]),"item.updatedAt":u(({value:a})=>[v(D(new Date(a).toLocaleString()),1)]),"item.edit":u(({item:a})=>[t(C,{icon:"mdi-pencil",variant:"text",onClick:ce=>E(a)},null,8,["onClick"])]),_:2},1032,["items","search"])]),_:1})]),_:1})]),_:1}),t(oe,{modelValue:s.value.open,"onUpdate:modelValue":e[14]||(e[14]=a=>s.value.open=a),persistent:""},{default:u(()=>[t(ge,{disabled:l(T),onSubmit:ee(l(W),["prevent"])},{default:u(()=>[t(ae,null,{default:u(()=>[t(le,null,{default:u(()=>[v(D(s.value.id?"編輯食物":"新增食物"),1)]),_:1}),t(te,null,{default:u(()=>[t(n,{modelValue:l(f).value.value,"onUpdate:modelValue":e[2]||(e[2]=a=>l(f).value.value=a),label:"食物名稱","error-messages":l(f).errorMessage.value},null,8,["modelValue","error-messages"]),t(fe,{modelValue:l(M).value.value,"onUpdate:modelValue":e[3]||(e[3]=a=>l(M).value.value=a),"error-messages":l(M).errorMessage.value,items:Q,label:"分類","item-title":"text","item-value":"value"},null,8,["modelValue","error-messages"]),t(n,{modelValue:l(V).value.value,"onUpdate:modelValue":e[4]||(e[4]=a=>l(V).value.value=a),label:"熱量","error-messages":l(V).errorMessage.value,type:"number",min:"0"},null,8,["modelValue","error-messages"]),t(n,{modelValue:l(b).value.value,"onUpdate:modelValue":e[5]||(e[5]=a=>l(b).value.value=a),label:"水分","error-messages":l(b).errorMessage.value,type:"number",min:"0"},null,8,["modelValue","error-messages"]),t(n,{modelValue:l(c).value.value,"onUpdate:modelValue":e[6]||(e[6]=a=>l(c).value.value=a),label:"蛋白質","error-messages":l(c).errorMessage.value,type:"number",min:"0"},null,8,["modelValue","error-messages"]),t(n,{modelValue:l(y).value.value,"onUpdate:modelValue":e[7]||(e[7]=a=>l(y).value.value=a),label:"脂肪","error-messages":l(y).errorMessage.value,type:"number",min:"0"},null,8,["modelValue","error-messages"]),t(n,{modelValue:l(x).value.value,"onUpdate:modelValue":e[8]||(e[8]=a=>l(x).value.value=a),label:"碳水化合物","error-messages":l(x).errorMessage.value,type:"number",min:"0"},null,8,["modelValue","error-messages"]),t(n,{modelValue:l(k).value.value,"onUpdate:modelValue":e[9]||(e[9]=a=>l(k).value.value=a),label:"鈉","error-messages":l(k).errorMessage.value,type:"number",min:"0"},null,8,["modelValue","error-messages"]),t(n,{modelValue:l(w).value.value,"onUpdate:modelValue":e[10]||(e[10]=a=>l(w).value.value=a),label:"膳食纖維","error-messages":l(w).errorMessage.value,type:"number",min:"0"},null,8,["modelValue","error-messages"]),t(n,{modelValue:l(U).value.value,"onUpdate:modelValue":e[11]||(e[11]=a=>l(U).value.value=a),label:"膽固醇","error-messages":l(U).errorMessage.value,type:"number",min:"0"},null,8,["modelValue","error-messages"]),t(o,{ref_key:"fileAgent",ref:$,modelValue:m.value,"onUpdate:modelValue":e[12]||(e[12]=a=>m.value=a),"raw-model-value":R.value,"onUpdate:rawModelValue":e[13]||(e[13]=a=>R.value=a),accept:"image/jpeg,image/png",deletable:"","max-size":"1MB","help-text":"點擊或拖曳檔案至此","error-text":{type:"檔案類型錯誤",size:"檔案大小超過限制"}},null,8,["modelValue","raw-model-value"])]),_:1}),t(re,null,{default:u(()=>[t(C,{onClick:B},{default:u(()=>e[17]||(e[17]=[v("取消")])),_:1}),t(C,{type:"submit",loading:l(T)},{default:u(()=>e[18]||(e[18]=[v("確認")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])],64)}}};typeof N=="function"&&N(Ve);export{Ve as default};
